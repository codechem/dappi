<div class="form-container scrollable-list">
  <form [formGroup]="contentForm" (ngSubmit)="onSubmit()">
    <div class="form-grid">
      <div class="form-column left-column">
        @for (field of leftColumnFields; track field) {
          <mat-form-field appearance="outline">
            <mat-label>{{ field.label }}</mat-label>
            @switch (field.type) {
              @case (fieldType.text) {
                <input
                  matInput
                  [placeholder]="field.placeholder || ''"
                  [formControlName]="field.key"
                  [required]="field.required"
                />
              }
              @case (fieldType.textarea) {
                <textarea
                  matInput
                  [placeholder]="field.placeholder || ''"
                  [formControlName]="field.key"
                  rows="5"
                  [required]="field.required"
                ></textarea>
              }
              @case (fieldType.collection) {
                <mat-select [formControlName]="field.key" [multiple]="field.multiple">
                  @for (item of field.relatedItems; track item) {
                    <mat-option [value]="item">
                      {{ getRelationDisplayValue(item, field) }}
                    </mat-option>
                  }
                </mat-select>
              }
              @case (fieldType.relation) {
                <mat-select [formControlName]="field.key">
                  @for (item of field.relatedItems; track item) {
                    <mat-option [value]="item">
                      {{ getRelationDisplayValue(item, field) }}
                    </mat-option>
                  }
                </mat-select>
              }
            }
            @if (contentForm.get(field.key)?.invalid && contentForm.get(field.key)?.touched) {
              <mat-error>
                {{ getErrorMessage(field.key) }}
              </mat-error>
            }
          </mat-form-field>
        }
      </div>

      <div class="form-column right-column">
        @for (field of fileFields; track field) {
          <div class="file-upload-container">
            <div class="file-label">
              {{ field.label }}
              @if (field.required) {
                <span class="required-field">*</span>
              }
            </div>
            <div
              class="file-upload-area"
              [class.has-file]="filePreviewUrl"
              [class.invalid-file]="fileFieldTouched && field.required && !selectedFile"
            >
              @if (!filePreviewUrl) {
                <div class="upload-instructions">
                  <mat-icon>upload_file_filled</mat-icon>
                  <div>
                    <a class="upload-link" (click)="fileInput.click()">Link</a> or drag and drop
                  </div>
                  <span class="file-types">SVG, PNG, JPG or GIF (max. 3MB)</span>
                  <input
                    #fileInput
                    type="file"
                    class="file-input"
                    accept="image/svg+xml,image/png,image/jpeg,image/gif"
                    (change)="onFileChange($event, field.key)"
                  />
                </div>
              }
              @if (filePreviewUrl) {
                <div class="file-preview">
                  <div class="file-preview-content">
                    <img [src]="filePreviewUrl" alt="Preview" class="preview-thumbnail" />
                    <div class="file-info">
                      <div class="file-name">{{ selectedFile?.name }}</div>
                      <div class="file-meta">
                        {{ getFileSize(selectedFile) }} â€¢ {{ uploadStatus }}
                      </div>
                    </div>
                  </div>
                  <div class="file-actions">
                    <button type="button" mat-icon-button class="remove-file" (click)="resetFile()">
                      <mat-icon>delete_outline</mat-icon>
                    </button>
                    <button type="button" mat-icon-button class="check-file">
                      <mat-icon>check_circle</mat-icon>
                    </button>
                  </div>
                </div>
              }
            </div>
            @if (fileFieldTouched && field.required && !selectedFile) {
              <div class="file-error-message">Please select a file</div>
            }
          </div>
        }

        @for (field of rightColumnFields; track field) {
          <mat-form-field appearance="outline">
            <mat-label>{{ field.label }}</mat-label>
            @switch (field.type) {
              @case (fieldType.text) {
                <input
                  matInput
                  [placeholder]="field.placeholder || ''"
                  [formControlName]="field.key"
                  [required]="field.required"
                />
              }
              @case (fieldType.textarea) {
                <textarea
                  matInput
                  [placeholder]="field.placeholder || ''"
                  [formControlName]="field.key"
                  rows="5"
                  [required]="field.required"
                ></textarea>
              }
              @case (fieldType.collection) {
                <mat-select [formControlName]="field.key" [multiple]="field.multiple">
                  @for (item of field.relatedItems; track item) {
                    <mat-option [value]="item">
                      {{ getRelationDisplayValue(item, field) }}
                    </mat-option>
                  }
                </mat-select>
              }
              @case (fieldType.relation) {
                <mat-select [formControlName]="field.key">
                  @for (item of field.relatedItems; track item) {
                    <mat-option [value]="item">
                      {{ getRelationDisplayValue(item, field) }}
                    </mat-option>
                  }
                </mat-select>
                @if (contentForm.get(field.key)?.invalid && contentForm.get(field.key)?.touched) {
                  <mat-error>
                    {{ getErrorMessage(field.key) }}
                  </mat-error>
                }
              }
            }
            @if (contentForm.get(field.key)?.invalid && contentForm.get(field.key)?.touched) {
              <mat-error>
                {{ getErrorMessage(field.key) }}
              </mat-error>
            }
          </mat-form-field>
        }
      </div>
    </div>
  </form>
</div>
